<!doctype html>
<html lang="ru"> {# –ö–ª–∞—Å—Å —Ç–µ–º—ã –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —Å—é–¥–∞ JS-—Å–∫—Ä–∏–ø—Ç–æ–º #}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}–ë–∞—Ä—Ç–µ—Ä –û–Ω–ª–∞–π–Ω{% endblock %}</title>

    <script>
        // –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –≤—ã—à–µ –≤ <head> –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–µ—Ä—Ü–∞–Ω–∏—è
        (function() {
            let themeAppliedInitialLoad = false; // –§–ª–∞–≥, —á—Ç–æ —Ç–µ–º–∞ –±—ã–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            try {
                const storedTheme = localStorage.getItem('theme');
                const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                let effectiveTheme = 'light'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–≤–µ—Ç–ª–∞—è

                if (storedTheme) {
                    effectiveTheme = storedTheme;
                } else if (systemPrefersDark) {
                    effectiveTheme = 'dark';
                }

                if (effectiveTheme === 'dark') {
                    document.documentElement.setAttribute('data-bs-theme', 'dark');
                    themeAppliedInitialLoad = true;
                } else {
                    document.documentElement.setAttribute('data-bs-theme', 'light');
                    // –ï—Å–ª–∏ —Ç–µ–º–∞ —Å–≤–µ—Ç–ª–∞—è –∏ —ç—Ç–æ –Ω–µ –¥–µ—Ñ–æ–ª—Ç, —Ç–æ–∂–µ –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–π, –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–ª–∞—Å—Å –¥–ª—è —Å–≤–µ—Ç–ª–æ–π
                    // themeAppliedInitialLoad = true; // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ, –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç–µ –∏ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–æ–π
                }

                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–π, –µ—Å–ª–∏ —Ç–µ–º–∞ –±—ã–ª–∞ –∞–∫—Ç–∏–≤–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
                // –∏ —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ localStorage –ø—É—Å—Ç –∏ —Å–∏—Å—Ç–µ–º–∞ —Å–≤–µ—Ç–ª–∞—è)
                if (themeAppliedInitialLoad || (storedTheme && storedTheme !== 'light')) { // –£—Å–ª–æ–≤–∏–µ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å
                    document.documentElement.classList.add('no-theme-transition-on-load');
                }

            } catch (e) {
                console.error('Error applying initial theme:', e);
            }
        })();
    </script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –¥–ª—è —Å–≤–µ—Ç–ª–æ–π, –∏ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã */
        :root {
            /* –¶–≤–µ—Ç–∞ –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è Bootstrap) */
            --body-bg: #f8f9fa;
            --body-color: #212529;
            --card-bg: #fff;
            --card-border-color: rgba(0, 0, 0, 0.175);
            --list-group-bg: #fff;
            --list-group-border-color: rgba(0, 0, 0, 0.125);
            --form-control-bg: #fff;
            --form-control-color: #212529;
            --form-control-border-color: #ced4da;
            --form-floating-label-color: #6c757d;
            --text-muted-color: #6c757d;
            --link-color: #0d6efd;
            --link-hover-color: #0a58ca;
            --alert-danger-bg: #f8d7da;
            --alert-danger-color: #842029;
            --alert-danger-border-color: #f5c2c7;
            --footer-bg: #e9ecef;
            --footer-color: #6c757d;
            --container-box-bg: #fff; /* –î–ª—è signup-container, login-container */
        }

        [data-bs-theme="dark"] {
            /* –¶–≤–µ—Ç–∞ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã */
            --body-bg: #212529;
            --body-color: #dee2e6;
            --card-bg: #2b3035; /* –ù–µ–º–Ω–æ–≥–æ —Å–≤–µ—Ç–ª–µ–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–æ–Ω–∞ */
            --card-border-color: #495057;
            --list-group-bg: #2b3035;
            --list-group-border-color: #495057;
            --form-control-bg: #343a40;
            --form-control-color: #dee2e6;
            --form-control-border-color: #495057;
            --form-floating-label-color: #adb5bd;
            --text-muted-color: #8d969e;
            --link-color: #8ab4f8;
            --link-hover-color: #a7c5f9;
            --alert-danger-bg: #49292d;
            --alert-danger-color: #f8d7da;
            --alert-danger-border-color: #5e3034;
            --footer-bg: #1c1f23;
            --footer-color: #adb5bd;
            --container-box-bg: #272b30;
        }

        body {
            padding-top: 5rem;
            padding-bottom: 60px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ—É—Ç–µ—Ä–∞ */
            background-color: var(--body-bg);
            color: var(--body-color);
            /* –ü–µ—Ä–µ—Ö–æ–¥ –¥–ª—è –ø–ª–∞–≤–Ω–æ–π —Å–º–µ–Ω—ã —Ç–µ–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }

        /* –ö–æ–≥–¥–∞ –µ—Å—Ç—å –∫–ª–∞—Å—Å no-theme-transition-on-load, –æ—Ç–∫–ª—é—á–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥—ã –¥–ª—è body –∏ –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        /* –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å '*' –¥–ª—è –±–æ–ª–µ–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è, –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω–æ */
        html.no-theme-transition-on-load body,
        html.no-theme-transition-on-load .card,
        html.no-theme-transition-on-load .list-group-item,
        html.no-theme-transition-on-load .form-control,
        html.no-theme-transition-on-load .signup-container,
        html.no-theme-transition-on-load .login-container,
        html.no-theme-transition-on-load .footer {
            transition: none !important;
        }
        /* –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –µ—â–µ –±–æ–ª–µ–µ –≥–ª–æ–±–∞–ª—å–Ω–æ, –Ω–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ: */
        /* html.no-theme-transition-on-load * { transition-duration: 0s !important; } */


        .card {
            background-color: var(--card-bg);
            border-color: var(--card-border-color);
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }
        .list-group-item {
            background-color: var(--list-group-bg);
            border-color: var(--list-group-border-color);
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }
        .form-control {
            background-color: var(--form-control-bg);
            color: var(--form-control-color);
            border-color: var(--form-control-border-color);
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }
        .form-control:focus { /* –§–æ–∫—É—Å –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –æ–±–µ–∏—Ö —Ç–µ–º */
            border-color: #86b7fe; /* Bootstrap primary focus color */
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
            background-color: var(--form-control-bg); /* –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ–Ω –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
            color: var(--form-control-color); /* –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
        }
        .form-floating > label {
            color: var(--form-floating-label-color);
        }
        .form-floating > .form-control:focus ~ label,
        .form-floating > .form-control:not(:placeholder-shown) ~ label {
            color: var(--form-floating-label-color); /* –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —á—É—Ç—å —è—Ä—á–µ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ */
            opacity: 0.65;
        }
        .text-muted { color: var(--text-muted-color) !important; } /* !important –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω—É–∂–µ–Ω –¥–ª—è Bootstrap */
        a { color: var(--link-color); }
        a:hover { color: var(--link-hover-color); }
        
        .alert-danger {
            background-color: var(--alert-danger-bg);
            color: var(--alert-danger-color);
            border-color: var(--alert-danger-border-color);
        }

        .footer {
            padding: 1rem 0;
            background-color: var(--footer-bg);
            color: var(--footer-color);
            text-align: center;
            position: fixed;
            bottom: 0;
            width: 100%;
            font-size: 0.9em;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }
        .container { max-width: 1140px; }
        .ad-card-img { max-height: 200px; object-fit: cover; width: 100%; }
        .signup-container, .login-container {
            max-width: 550px;
            margin-top: 2rem;
            margin-bottom: 3rem;
            padding: 2rem;
            background-color: var(--container-box-bg); /* –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é */
            border-radius: 0.5rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
             transition: background-color 0.2s ease-in-out;
        }
        /* ... –¥—Ä—É–≥–∏–µ –æ–±—â–∏–µ —Å—Ç–∏–ª–∏ –∏ —Å—Ç–∏–ª–∏ –¥–ª—è password-requirements ... */
        .password-requirements { /* ... –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –æ—Ç–≤–µ—Ç–µ ... */ }
    </style>
    {% block extra_head %}{% endblock %}
</head>
<body> {# –ö–ª–∞—Å—Å no-theme-transition-on-load –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω –∫ <html>, –∞ –Ω–µ <body> #}
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'ads:ad_list' %}">–ë–∞—Ä—Ç–µ—Ä –û–Ω–ª–∞–π–Ω</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav me-auto mb-2 mb-md-0">
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'ad_list' %}active{% endif %}" href="{% url 'ads:ad_list' %}">–í—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</a>
                    </li>
                    {% if user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'ad_create' %}active{% endif %}" href="{% url 'ads:ad_create' %}">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'my_ads' %}active{% endif %}" href="{% url 'ads:my_ads' %}">–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'my_proposals' %}active{% endif %}" href="{% url 'ads:my_proposals' %}">–ú–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</a>
                    </li>
                    {% endif %}
                </ul>
                <ul class="navbar-nav ms-auto mb-2 mb-md-0">
                    {% if user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownUser" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                {{ user.username }}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownUser">
                                <li>
                                    <form id="logout-form" method="post" action="{% url 'logout' %}">
                                        {% csrf_token %}
                                        <button type="submit" class="dropdown-item">–í—ã–π—Ç–∏</button>
                                    </form>
                                </li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link {% if request.resolver_match.url_name == 'login' %}active{% endif %}" href="{% url 'login' %}?next={{ request.path }}">–í–æ–π—Ç–∏</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if request.resolver_match.url_name == 'signup' %}active{% endif %}" href="{% url 'signup' %}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                        </li>
                    {% endif %}
                     <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownApi" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            API
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownApi">
                            <li><a class="dropdown-item" href="/api/ads/" target="_blank">API –æ–±—ä—è–≤–ª–µ–Ω–∏–π</a></li>
                            <li><a class="dropdown-item" href="/api/proposals/" target="_blank">API –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</a></li>
                        </ul>
                    </li>
                     <li class="nav-item"> {# –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã #}
                        <button id="theme-toggle-btn" class="btn btn-outline-secondary ms-2" type="button">
                            <span id="theme-icon">Icon</span> {# –ò–∫–æ–Ω–∫–∞ –±—É–¥–µ—Ç –º–µ–Ω—è—Ç—å—Å—è JS #}
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container">
        {% if messages %}
            <div class="mt-3">
            {% for message in messages %}
                <div class="alert alert-{% if message.tags %}{{ message.tags }}{% else %}info{% endif %} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
            </div>
        {% endif %}

        {% block content %}
        <!-- Page specific content will go here -->
        {% endblock %}
    </main>

    <footer class="footer mt-auto py-3"> {# –£–±—Ä–∞–ª bg-light, –±—É–¥–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π --footer-bg #}
        <div class="container text-center">
            <span>¬© {% now "Y" %} –ë–∞—Ä—Ç–µ—Ä –û–Ω–ª–∞–π–Ω.</span>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    
    <script>
        // –°–∫—Ä–∏–ø—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞ no-theme-transition-on-load –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.documentElement.classList.remove('no-theme-transition-on-load');
            }, 0);
        });

        // –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
        const themeToggleButton = document.getElementById('theme-toggle-btn');
        const themeIcon = document.getElementById('theme-icon'); // –î–ª—è –∏–∫–æ–Ω–∫–∏ —Å–æ–ª–Ω—Ü–µ/–ª—É–Ω–∞
        const htmlElement = document.documentElement;

        function setTheme(theme) {
            htmlElement.setAttribute('data-bs-theme', theme);
            localStorage.setItem('theme', theme);
            updateThemeIcon(theme);
        }

        function updateThemeIcon(theme) {
            if (theme === 'dark') {
                themeIcon.textContent = '‚òÄÔ∏è'; // –ò–∫–æ–Ω–∫–∞ —Å–æ–ª–Ω—Ü–∞ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —Å–≤–µ—Ç–ª—É—é
            } else {
                themeIcon.textContent = 'üåô'; // –ò–∫–æ–Ω–∫–∞ –ª—É–Ω—ã –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —Ç–µ–º–Ω—É—é
            }
        }
        
        if (themeToggleButton) {
            themeToggleButton.addEventListener('click', () => {
                const currentTheme = htmlElement.getAttribute('data-bs-theme') || 'light';
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                setTheme(newTheme);
            });
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∫–æ–Ω–∫—É –ø—Ä–∏ –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
        const initialTheme = htmlElement.getAttribute('data-bs-theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        updateThemeIcon(initialTheme);

    </script>
    {% block extra_scripts %}{% endblock %} {# –í–∞—à –∫–∞—Å—Ç–æ–º–Ω—ã–π JS –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü (–Ω–∞–ø—Ä–∏–º–µ—Ä, signup) #}
</body>
</html>